<div class="memoria-game-container">
    <!-- Panel de configuraciÃ³n (solo visible si no hay juego iniciado) -->
    <div class="config-panel" *ngIf="!juegoIniciado">
        <p-card>
            <ng-template pTemplate="header">
                <div class="card-header">
                    <h2>ðŸŽ® Juego de Memoria Cultural</h2>
                    <p>Aprende sobre la cultura CaÃ±ari e Inca mientras juegas</p>
                </div>
            </ng-template>

            <div class="config-content">
                <!-- Selector de Nivel -->
                <div class="field">
                    <label for="nivel">Nivel de Dificultad</label>
                    <p-select
                        id="nivel"
                        [options]="nivelesDisponibles"
                        [(ngModel)]="nivelSeleccionado"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Selecciona un nivel"
                        [style]="{'width':'100%'}">
                    </p-select>
                </div>

                <!-- Selector de CategorÃ­a -->
                <div class="field">
                    <label for="categoria">CategorÃ­a Cultural</label>
                    <p-selectButton
                        id="categoria"
                        [options]="categoriasDisponibles"
                        [(ngModel)]="categoriaSeleccionada"
                        optionLabel="label"
                        optionValue="value">
                    </p-selectButton>
                </div>

                <!-- BotÃ³n Iniciar -->
                <div class="field">
                    <p-button
                        label="Iniciar Juego"
                        icon="pi pi-play"
                        (onClick)="iniciarJuego()"
                        [style]="{'width':'100%'}"
                        styleClass="p-button-lg p-button-success">
                    </p-button>
                </div>
            </div>
        </p-card>
    </div>

    <!-- Panel de juego (solo visible si el juego estÃ¡ iniciado) -->
    <div class="game-panel" *ngIf="juegoIniciado && !juegoTerminado">
        <div class="game-header">
            <p-card>
                <div class="flex justify-content-between align-items-center">
                    <div class="game-stats">
                        <div class="stat-item">
                            <i class="pi pi-clock"></i>
                            <span>{{ tiempoTranscurrido }}s</span>
                        </div>
                        <div class="stat-item">
                            <i class="pi pi-sync"></i>
                            <span>{{ intentos }} intentos</span>
                        </div>
                        <div class="stat-item">
                            <i class="pi pi-check"></i>
                            <span>{{ parejasEncontradas }} / {{ tarjetas.length / 2 }}</span>
                        </div>
                    </div>

                    <div class="game-controls">
                        <p-button
                            icon="pi pi-refresh"
                            label="Reiniciar"
                            (onClick)="reiniciarJuego()"
                            severity="secondary">
                        </p-button>
                    </div>
                </div>
            </p-card>
        </div>

        <div class="game-board" [ngClass]="getGridClass()">
            <div *ngFor="let tarjeta of tarjetas"
                 class="memory-card"
                 [ngClass]="{
                   'flipped': tarjeta.volteada,
                   'matched': tarjeta.emparejada
                 }"
                 (click)="voltearTarjeta(tarjeta)">

                <div class="card-inner">
                    <div class="card-back">
                        <div class="back-pattern">
                            <i class="pi pi-star-fill"></i>
                            <span class="chakana">âœ¦</span>
                        </div>
                    </div>

                    <div class="card-front">
                        <img [src]="tarjeta.imagen" [alt]="tarjeta.nombreEspanol">
                        <div class="card-label">
                            <p class="kichwa-name">{{ tarjeta.nombreKichwa }}</p>
                            <p class="spanish-name">{{ tarjeta.nombreEspanol }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DiÃ¡logo de victoria -->
    <p-dialog
        [(visible)]="juegoTerminado"
        [modal]="true"
        [closable]="false"
        [style]="{width: '450px'}"
        header="Â¡Allillachu! (Â¡Muy bien!)">

        <div class="resultados-content">
            <div class="puntuacion-final">
                <i class="pi pi-star-fill" style="color: gold; font-size: 3rem;"></i>
                <h3>{{ puntuacionFinal }} puntos</h3>
            </div>

            <p-divider></p-divider>

            <div class="estadisticas-finales">
                <div class="estadistica">
                    <span class="label">Tiempo:</span>
                    <span class="valor">{{ tiempoTranscurrido }}s</span>
                </div>
                <div class="estadistica">
                    <span class="label">Intentos:</span>
                    <span class="valor">{{ intentos }}</span>
                </div>
                <div class="estadistica">
                    <span class="label">PrecisiÃ³n:</span>
                    <span class="valor">{{ calcularPrecision() }}%</span>
                </div>
            </div>

            <div *ngIf="insigniasNuevas.length > 0" class="insignias-nuevas">
                <h4>Â¡Nuevas insignias!</h4>
                <div class="insignias-grid">
                    <div *ngFor="let insignia of insigniasNuevas" class="insignia-item">
                        <img [src]="insignia.icono" [alt]="insignia.nombre">
                        <p>{{ insignia.nombreKichwa }}</p>
                    </div>
                </div>
            </div>
        </div>

        <ng-template pTemplate="footer">
            <p-button
                label="Jugar de nuevo"
                icon="pi pi-refresh"
                (onClick)="reiniciarJuego()">
            </p-button>
            <p-button
                label="Volver al menÃº"
                icon="pi pi-home"
                severity="secondary"
                (onClick)="volverAlMenu()">
            </p-button>
        </ng-template>
    </p-dialog>
</div>

<p-toast position="top-center"></p-toast>
