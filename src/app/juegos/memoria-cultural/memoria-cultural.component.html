<div class="memoria-game-container">
    <div class="game-header">
        <p-card>
            <div class="flex justify-content-between align-items-center">
                <div class="game-stats">
                    <div class="stat-item">
                        <i class="pi pi-clock"></i>
                        <span>{{ tiempoTranscurrido }}s</span>
                    </div>
                    <div class="stat-item">
                        <i class="pi pi-sync"></i>
                        <span>{{ intentos }} intentos</span>
                    </div>
                    <div class="stat-item">
                        <i class="pi pi-check"></i>
                        <span>{{ parejasEncontradas }} / {{ tarjetas.length / 2 }}</span>
                    </div>
                </div>

                <div class="game-controls">
                    <p-select
                        [(ngModel)]="categoriaSeleccionada"
                        [options]="categoriasDisponibles"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Categoría"
                        (onChange)="inicializarJuego()"
                        [disabled]="!juegoTerminado"
                        [style]="{'margin-right': '1rem'}">
                    </p-select>

                    <p-selectButton
                        [(ngModel)]="dificultad"
                        [options]="opcionesDificultad"
                        optionLabel="label"
                        optionValue="value"
                        (onChange)="inicializarJuego()"
                        [disabled]="!juegoTerminado">
                    </p-selectButton>
                </div>
            </div>
        </p-card>
    </div>

    <div class="game-board" [ngClass]="'grid-' + dificultad">
        <div *ngFor="let tarjeta of tarjetas"
             class="memory-card"
             [ngClass]="{
               'flipped': tarjeta.volteada,
               'matched': tarjeta.emparejada
             }"
             (click)="voltearTarjeta(tarjeta)">

            <div class="card-inner">
                <div class="card-back">
                    <div class="back-pattern">?</div>
                </div>

                <div class="card-front">
                    <img [src]="tarjeta.imagen" [alt]="tarjeta.nombreEspanol">
                    <div class="card-label">
                        <p class="kichwa-name">{{ tarjeta.nombreKichwa }}</p>
                        <p class="spanish-name">{{ tarjeta.nombreEspanol }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <p-dialog
        [(visible)]="juegoTerminado"
        [modal]="true"
        [closable]="false"
        [style]="{width: '450px'}"
        header="¡Allillachu! (¡Muy bien!)">

        <div class="resultados-content">
            <div class="puntuacion-final">
                <i class="pi pi-star-fill" style="color: gold; font-size: 3rem;"></i>
                <h3>{{ puntuacionFinal }} puntos</h3>
            </div>

            <p-divider></p-divider>

            <div class="estadisticas-finales">
                <div class="estadistica">
                    <span class="label">Tiempo:</span>
                    <span class="valor">{{ tiempoTranscurrido }}s</span>
                </div>
                <div class="estadistica">
                    <span class="label">Intentos:</span>
                    <span class="valor">{{ intentos }}</span>
                </div>
                <div class="estadistica">
                    <span class="label">Precisión:</span>
                    <span class="valor">{{ calcularPrecision() }}%</span>
                </div>
            </div>

            <div *ngIf="insigniasNuevas.length > 0" class="insignias-nuevas">
                <h4>¡Nuevas insignias!</h4>
                <div class="insignias-grid">
                    <div *ngFor="let insignia of insigniasNuevas" class="insignia-item">
                        <img [src]="insignia.icono" [alt]="insignia.nombre">
                        <p>{{ insignia.nombreKichwa }}</p>
                    </div>
                </div>
            </div>
        </div>

        <ng-template pTemplate="footer">
            <p-button
                label="Jugar de nuevo"
                icon="pi pi-refresh"
                (onClick)="reiniciarJuego()">
            </p-button>
            <p-button
                label="Volver al menú"
                icon="pi pi-home"
                severity="secondary"
                (onClick)="volverAlMenu()">
            </p-button>
        </ng-template>
    </p-dialog>
</div>

<p-toast position="top-center"></p-toast>
