<!-- ejecutar-mision.component.html -->
<div class="ejecutar-mision-container" *ngIf="mision && faseActual">
    <!-- Header con Progreso -->
    <div class="header-ejecucion">
        <p-card>
            <div class="flex justify-content-between align-items-center flex-wrap">
                <!-- Info de la Misi√≥n -->
                <div class="info-mision">
                    <h2>{{ mision.titulo }}</h2>
                    <p class="fase-actual-texto">
                        Fase {{ progreso!.faseActual + 1 }} de {{ mision.fases.length }}:
                        {{ faseActual.titulo || 'Fase ' + (progreso!.faseActual + 1) }}
                    </p>
                </div>

                <!-- Stats en Tiempo Real -->
                <div class="stats-tiempo-real">
                    <div class="stat-item">
                        <i class="pi pi-clock"></i>
                        <span>{{ formatearTiempo(progreso!.tiempoTranscurrido) }}</span>
                    </div>
                    <div class="stat-item">
                        <i class="pi pi-check text-green-500"></i>
                        <span>{{ progreso!.respuestasCorrectas }}</span>
                    </div>
                    <div class="stat-item">
                        <i class="pi pi-times text-red-500"></i>
                        <span>{{ progreso!.respuestasIncorrectas }}</span>
                    </div>
                    <div class="stat-item">
                        <i class="pi pi-star-fill text-yellow-500"></i>
                        <span>{{ progreso!.puntuacion }}</span>
                    </div>
                </div>

                <!-- Acciones R√°pidas -->
                <div class="acciones-rapidas">
                    <p-button
                        icon="pi pi-question-circle"
                        [rounded]="true"
                        [outlined]="true"
                        [disabled]="!faseActual.pregunta"
                        pTooltip="Usar Pista (-10 pts)"
                        (onClick)="usarPista()">
                    </p-button>
                    <p-button
                        icon="pi pi-times"
                        [rounded]="true"
                        severity="danger"
                        [outlined]="true"
                        pTooltip="Abandonar Misi√≥n"
                        (onClick)="mostrarDialogAbandonar = true">
                    </p-button>
                </div>
            </div>

            <!-- Barra de Progreso General -->
            <p-progressBar
                [value]="calcularProgreso()"
                [showValue]="false"
                styleClass="mt-3">
            </p-progressBar>
        </p-card>
    </div>

    <!-- Contenido de la Fase -->
    <div class="contenido-fase">
        <div class="grid">
            <!-- Columna Principal -->
            <div class="col-12 lg:col-8">

                <!-- FASE TIPO: INTRODUCCI√ìN / CONCLUSI√ìN -->
                <p-card *ngIf="faseActual.tipo === TipoFase.INTRODUCCION ||
                       faseActual.tipo === TipoFase.CONCLUSION">

                    <!-- Imagen si existe -->
                    <div class="fase-imagen" *ngIf="faseActual.imagenUrl">
                        <img [src]="faseActual.imagenUrl" [alt]="faseActual.titulo">
                    </div>

                    <!-- Narrativa con efecto typing -->
                    <div class="narrativa-contenedor" (click)="saltarAnimacion()">
                        <p class="narrativa-texto">{{ narrativaVisible }}</p>

                        <small *ngIf="!narrativaCompleta" class="typing-hint">
                            <i class="pi pi-forward"></i> Click para mostrar todo
                        </small>
                    </div>

                    <!-- Bot√≥n continuar -->
                    <div class="acciones-fase" *ngIf="narrativaCompleta">
                        <p-button
                            label="Continuar"
                            icon="pi pi-arrow-right"
                            iconPos="right"
                            (onClick)="avanzarFase()">
                        </p-button>
                    </div>
                </p-card>

                <!-- FASE TIPO: AN√ÅLISIS IMAGEN -->
                <p-card *ngIf="faseActual.tipo === TipoFase.ANALISIS_IMAGEN">
                    <h3>{{ faseActual.titulo }}</h3>

                    <p *ngIf="faseActual.textoNarrativa" class="intro-texto">
                        {{ faseActual.textoNarrativa }}
                    </p>

                    <!-- Imagen a analizar -->
                    <div class="imagen-analisis">
                        <img [src]="faseActual.imagenUrl" alt="Imagen para an√°lisis">
                    </div>

                    <!-- Estado: Cargando an√°lisis -->
                    <div *ngIf="cargandoAnalisis" class="analisis-cargando">
                        <p-progressSpinner
                            strokeWidth="4"
                            [style]="{width: '60px', height: '60px'}">
                        </p-progressSpinner>
                        <p class="mt-3">
                            <i class="pi pi-spin pi-spinner"></i>
                            Analizando imagen con IA...
                        </p>
                        <p class="text-sm text-500">
                            El modelo BLIP-2 est√° procesando la imagen
                        </p>
                    </div>

                    <!-- Resultado del an√°lisis -->
                    <div *ngIf="analisisCompleto && !cargandoAnalisis" class="analisis-resultado">
                        <div class="analisis-header">
                            <i class="pi pi-check-circle text-green-500"></i>
                            <h4>An√°lisis Completado</h4>
                        </div>

                        <div class="analisis-texto" (click)="saltarAnimacion()">
                            <p>{{ narrativaVisible }}</p>

                            <small *ngIf="!narrativaCompleta" class="typing-hint">
                                <i class="pi pi-forward"></i> Click para mostrar todo
                            </small>
                        </div>
                    </div>

                    <!-- Bot√≥n continuar -->
                    <div class="acciones-fase" *ngIf="narrativaCompleta">
                        <p-button
                            label="Continuar"
                            icon="pi pi-arrow-right"
                            iconPos="right"
                            (onClick)="avanzarFase()">
                        </p-button>
                    </div>
                </p-card>

                <!-- FASE TIPO: B√öSQUEDA DE PUNTOS -->
                <p-card *ngIf="faseActual.tipo === TipoFase.BUSQUEDA_PUNTO">
                    <h3>{{ faseActual.titulo }}</h3>

                    <p *ngIf="faseActual.textoNarrativa" class="intro-texto">
                        {{ faseActual.textoNarrativa }}
                    </p>

                    <!-- Progreso de B√∫squeda -->
                    <div class="progreso-busqueda">
                        <div class="flex justify-content-between mb-2">
                            <span>Puntos visitados:</span>
                            <span><strong>{{ puntosVisitados.length }} / {{ puntosObjetivo.length }}</strong></span>
                        </div>
                        <p-progressBar
                            [value]="calcularProgresoBusqueda()"
                            [showValue]="false">
                        </p-progressBar>
                    </div>

                    <!-- Lista de Puntos -->
                    <div class="puntos-objetivo-lista">
                        <div
                            *ngFor="let puntoId of puntosObjetivo; let i = index"
                            class="punto-objetivo-item"
                            [class.punto-visitado]="puntosVisitados.includes(puntoId)"
                            [class.punto-actual]="puntosVisitados.length === i">

                            <div class="punto-numero">
                                <i *ngIf="!puntosVisitados.includes(puntoId)" class="pi pi-map-marker"></i>
                                <i *ngIf="puntosVisitados.includes(puntoId)" class="pi pi-check-circle"></i>
                            </div>

                            <div class="punto-info">
                                <h4>Punto {{ i + 1 }}</h4>
                                <p *ngIf="!puntosVisitados.includes(puntoId)" class="punto-estado">
                                    Pendiente de visita
                                </p>
                                <p *ngIf="puntosVisitados.includes(puntoId)" class="punto-estado visitado">
                                    ‚úÖ Visitado
                                </p>
                            </div>

                            <p-button
                                *ngIf="!puntosVisitados.includes(puntoId)"
                                label="Visitar"
                                icon="pi pi-arrow-right"
                                [disabled]="puntosVisitados.length !== i"
                                (onClick)="visitarPunto(puntoId)">
                            </p-button>
                        </div>
                    </div>

                    <!-- Pista Actual -->
                    <p-card
                        *ngIf="pistaActualBusqueda"
                        header="Descubrimiento"
                        styleClass="mt-3 pista-busqueda">
                        <p>{{ pistaActualBusqueda }}</p>
                    </p-card>

                    <!-- Bot√≥n Continuar -->
                    <div class="acciones-fase" *ngIf="puntosVisitados.length === puntosObjetivo.length">
                        <p-button
                            label="Continuar"
                            icon="pi pi-arrow-right"
                            iconPos="right"
                            (onClick)="avanzarFase()">
                        </p-button>
                    </div>
                </p-card>

                <!-- FASE TIPO: ORDENAMIENTO -->
                <p-card *ngIf="faseActual.tipo === TipoFase.ORDENAMIENTO && faseActual.puzzle">
                    <h3>{{ faseActual.titulo }}</h3>

                    <p *ngIf="faseActual.textoNarrativa" class="intro-texto">
                        {{ faseActual.textoNarrativa }}
                    </p>

                    <!-- Instrucciones -->
                    <div class="instrucciones-ordenamiento">
                        <i class="pi pi-info-circle"></i>
                        <p>Arrastra los elementos para ordenarlos cronol√≥gicamente en el ciclo sagrado del agua</p>
                    </div>

                    <!-- Ayuda Visual (si existe) -->
                    <div *ngIf="faseActual.puzzle.ayudaVisual" class="ayuda-visual">
                        <i class="pi pi-lightbulb"></i>
                        <p>{{ faseActual.puzzle.ayudaVisual }}</p>
                    </div>

                    <!-- Lista de Elementos Ordenables -->
                    <div
                        cdkDropList
                        class="elementos-ordenamiento-lista"
                        (cdkDropListDropped)="onDropOrdenamiento($event)">

                        <div
                            *ngFor="let elemento of elementosOrdenamiento; let i = index"
                            cdkDrag
                            class="elemento-ordenamiento"
                            [class.elemento-correcto]="mostrandoResultadoOrden && ordenEsCorrecto"
                            [class.elemento-incorrecto]="mostrandoResultadoOrden && !ordenEsCorrecto">

                            <!-- N√∫mero de orden -->
                            <div class="elemento-numero">{{ i + 1 }}</div>

                            <!-- Imagen (si existe) -->
                            <div class="elemento-imagen" *ngIf="elemento.imagen">
                                <img [src]="elemento.imagen" [alt]="elemento.contenido">
                            </div>

                            <!-- Contenido -->
                            <div class="elemento-contenido">
                                <p>{{ elemento.contenido }}</p>
                            </div>

                            <!-- Handle de arrastre -->
                            <div class="drag-handle" cdkDragHandle>
                                <i class="pi pi-bars"></i>
                            </div>

                            <!-- Placeholder mientras se arrastra -->
                            <div class="elemento-placeholder" *cdkDragPlaceholder></div>
                        </div>
                    </div>

                    <!-- Feedback de Resultado -->
                    <div *ngIf="mostrandoResultadoOrden" class="feedback-ordenamiento"
                         [class.feedback-correcto]="ordenEsCorrecto"
                         [class.feedback-incorrecto]="!ordenEsCorrecto">

                        <div class="feedback-header">
                            <i [class]="ordenEsCorrecto ? 'pi pi-check-circle' : 'pi pi-times-circle'"></i>
                            <h4>{{ ordenEsCorrecto ? '¬°Orden Correcto!' : 'Orden Incorrecto' }}</h4>
                        </div>

                        <p *ngIf="ordenEsCorrecto">
                            Has comprendido perfectamente el ciclo sagrado del agua en la cosmovisi√≥n andina.
                            El agua fluye desde su nacimiento puro, desciende al inframundo para purificarse,
                            renace en el mundo presente, y finalmente asciende como ofrenda al mundo celestial.
                        </p>

                        <p *ngIf="!ordenEsCorrecto">
                            El orden no es correcto. Recuerda: el ciclo representa el viaje del agua a trav√©s
                            de los tres mundos andinos. Piensa en el ciclo de la vida: nacimiento ‚Üí muerte ‚Üí
                            renacimiento ‚Üí trascendencia.
                        </p>
                    </div>

                    <!-- Acciones -->
                    <div class="acciones-fase">
                        <p-button
                            *ngIf="!mostrandoResultadoOrden"
                            label="Verificar Orden"
                            icon="pi pi-check"
                            [disabled]="!ordenCambiado"
                            (onClick)="verificarOrdenamiento()">
                        </p-button>

                        <p-button
                            *ngIf="mostrandoResultadoOrden && !ordenEsCorrecto"
                            label="Intentar de Nuevo"
                            icon="pi pi-refresh"
                            severity="warn"
                            (onClick)="reintentar()">
                        </p-button>

                        <p-button
                            *ngIf="mostrandoResultadoOrden && ordenEsCorrecto"
                            label="Continuar"
                            icon="pi pi-arrow-right"
                            iconPos="right"
                            (onClick)="avanzarFase()">
                        </p-button>
                    </div>
                </p-card>

                <!-- FASE TIPO: PREGUNTA M√öLTIPLE -->
                <p-card *ngIf="faseActual.tipo === TipoFase.PREGUNTA_MULTIPLE && faseActual.pregunta">
                    <h3>{{ faseActual.titulo }}</h3>

                    <p *ngIf="faseActual.textoNarrativa" class="intro-texto">
                        {{ faseActual.textoNarrativa }}
                    </p>

                    <!-- Imagen relacionada -->
                    <div class="imagen-pregunta" *ngIf="faseActual.imagenUrl">
                        <img [src]="faseActual.imagenUrl" alt="Contexto visual">
                    </div>

                    <!-- Pregunta -->
                    <div class="pregunta-contenedor">
                        <h4 class="pregunta-texto">{{ faseActual.pregunta.textoPregunta }}</h4>

                        <!-- Opciones -->
                        <div class="opciones-lista">
                            <div *ngFor="let opcion of faseActual.pregunta.opciones"
                                 class="opcion-item"
                                 [class.opcion-seleccionada]="respuestaSeleccionada === opcion.id"
                                 [class.opcion-correcta]="mostrandoFeedback && opcion.correcta"
                                 [class.opcion-incorrecta]="mostrandoFeedback && !opcion.correcta && respuestaSeleccionada === opcion.id">

                                <p-radioButton
                                    [value]="opcion.id"
                                    [(ngModel)]="respuestaSeleccionada"
                                    [inputId]="opcion.id"
                                    [disabled]="mostrandoFeedback">
                                </p-radioButton>

                                <label [for]="opcion.id" class="opcion-label">
                                    <span class="opcion-letra">{{ opcion.id }}</span>
                                    <span class="opcion-texto">{{ opcion.texto }}</span>
                                </label>

                                <!-- Icono de resultado -->
                                <i *ngIf="mostrandoFeedback && opcion.correcta"
                                   class="pi pi-check-circle resultado-icono correcto"></i>
                                <i *ngIf="mostrandoFeedback && !opcion.correcta && respuestaSeleccionada === opcion.id"
                                   class="pi pi-times-circle resultado-icono incorrecto"></i>
                            </div>
                        </div>

                        <!-- Feedback -->
                        <div *ngIf="mostrandoFeedback" class="feedback-contenedor"
                             [class.feedback-correcto]="feedbackCorrecto"
                             [class.feedback-incorrecto]="!feedbackCorrecto">

                            <div class="feedback-header">
                                <i [class]="feedbackCorrecto ? 'pi pi-check-circle' : 'pi pi-times-circle'"></i>
                                <h4>{{ feedbackCorrecto ? '¬°Correcto!' : 'Incorrecto' }}</h4>
                            </div>

                            <p class="feedback-texto">{{ feedbackMensaje }}</p>

                            <!-- Elementos clave aprendidos -->
                            <div *ngIf="feedbackCorrecto && faseActual.pregunta.elementosClave"
                                 class="elementos-clave">
                                <p class="elementos-titulo">üîë Conceptos clave:</p>
                                <div class="elementos-lista">
                  <span *ngFor="let elemento of faseActual.pregunta.elementosClave"
                        class="elemento-tag">
                    {{ elemento }}
                  </span>
                                </div>
                            </div>
                        </div>

                        <!-- Acciones -->
                        <div class="acciones-fase">
                            <p-button
                                *ngIf="!mostrandoFeedback"
                                label="Verificar Respuesta"
                                icon="pi pi-check"
                                [disabled]="!respuestaSeleccionada"
                                (onClick)="verificarRespuesta()">
                            </p-button>

                            <p-button
                                *ngIf="mostrandoFeedback && !feedbackCorrecto"
                                label="Intentar de Nuevo"
                                icon="pi pi-refresh"
                                severity="warn"
                                (onClick)="mostrandoFeedback = false; respuestaSeleccionada = ''">
                            </p-button>

                            <p-button
                                *ngIf="mostrandoFeedback && feedbackCorrecto"
                                label="Continuar"
                                icon="pi pi-arrow-right"
                                iconPos="right"
                                (onClick)="avanzarFase()">
                            </p-button>
                        </div>
                    </div>
                </p-card>

                <!-- FASE TIPO: PREGUNTA ABIERTA -->
                <p-card *ngIf="faseActual.tipo === TipoFase.PREGUNTA_ABIERTA && faseActual.pregunta">
                    <h3>{{ faseActual.titulo }}</h3>

                    <div class="pregunta-contenedor">
                        <h4 class="pregunta-texto">{{ faseActual.pregunta.textoPregunta }}</h4>

                        <div class="respuesta-abierta-contenedor">
              <textarea
                  pInputTextarea
                  [(ngModel)]="respuestaAbierta"
                  [rows]="5"
                  [disabled]="mostrandoFeedback"
                  placeholder="Escribe tu respuesta aqu√≠..."
                  class="respuesta-textarea">
              </textarea>

                            <small class="ayuda-texto">
                                üí° Tip: S√© espec√≠fico y usa los conceptos aprendidos
                            </small>
                        </div>

                        <!-- Feedback -->
                        <div *ngIf="mostrandoFeedback" class="feedback-contenedor"
                             [class.feedback-correcto]="feedbackCorrecto"
                             [class.feedback-incorrecto]="!feedbackCorrecto">

                            <div class="feedback-header">
                                <i [class]="feedbackCorrecto ? 'pi pi-check-circle' : 'pi pi-times-circle'"></i>
                                <h4>{{ feedbackCorrecto ? '¬°Excelente!' : 'Revisa tu respuesta' }}</h4>
                            </div>

                            <p class="feedback-texto">{{ feedbackMensaje }}</p>
                        </div>

                        <!-- Acciones -->
                        <div class="acciones-fase">
                            <p-button
                                *ngIf="!mostrandoFeedback"
                                label="Enviar Respuesta"
                                icon="pi pi-send"
                                [disabled]="respuestaAbierta.length < 10"
                                (onClick)="verificarRespuesta()">
                            </p-button>

                            <p-button
                                *ngIf="mostrandoFeedback"
                                label="Continuar"
                                icon="pi pi-arrow-right"
                                iconPos="right"
                                (onClick)="avanzarFase()">
                            </p-button>
                        </div>
                    </div>
                </p-card>

            </div>

            <!-- Columna Lateral: Info Contextual -->
            <div class="col-12 lg:col-4">
                <!-- NPC Gu√≠a -->
                <p-card header="Tu Gu√≠a" styleClass="mb-3">
                    <div class="npc-lateral">
                        <img [src]="mision.npcGuia.avatar" [alt]="mision.npcGuia.nombre" class="npc-avatar">
                        <h4>{{ mision.npcGuia.nombre }}</h4>
                        <p class="npc-nombre-kichwa">{{ mision.npcGuia.nombreKichwa }}</p>
                    </div>
                </p-card>

                <!-- Progreso Detallado -->
                <p-card header="Tu Progreso" styleClass="mb-3">
                    <div class="progreso-detallado">
                        <div class="progreso-item">
                            <span class="label">Fases Completadas:</span>
                            <span class="valor">{{ progreso!.faseActual }} / {{ mision.fases.length }}</span>
                        </div>
                        <div class="progreso-item">
                            <span class="label">Precisi√≥n:</span>
                            <span class="valor">
                {{ progreso!.intentos > 0 ?
                                (progreso!.respuestasCorrectas / progreso!.intentos * 100 | number:'1.0-0') : 0 }}%
              </span>
                        </div>
                        <div class="progreso-item">
                            <span class="label">Pistas Usadas:</span>
                            <span class="valor">{{ progreso!.pistasUsadas }}</span>
                        </div>
                    </div>
                </p-card>

                <!-- Recompensas Pendientes -->
                <p-card header="Recompensas al Completar">
                    <div class="recompensas-preview">
                        <div class="recompensa-item">
                            <i class="pi pi-bolt text-yellow-500"></i>
                            <span>+{{ mision.recompensas.experiencia }} XP</span>
                        </div>
                        <div class="recompensa-item">
                            <i class="pi pi-star text-blue-500"></i>
                            <span>+{{ mision.recompensas.puntos }} Puntos</span>
                        </div>
                        <p-divider></p-divider>
                        <div class="insignias-preview">
                            <p class="insignias-titulo">üèÜ Insignias:</p>
                            <div *ngFor="let insignia of mision.recompensas.insignias" class="insignia-mini">
                                <span class="insignia-icono">{{ insignia.icono }}</span>
                                <span class="insignia-nombre">{{ insignia.nombre }}</span>
                            </div>
                        </div>
                    </div>
                </p-card>
            </div>
        </div>
    </div>
</div>

<!-- Dialog: Pista -->
<p-dialog
    [(visible)]="mostrarDialogPista"
    [modal]="true"
    [style]="{width: '400px'}"
    header="üí° Pista">

    <div class="pista-contenido">
        <p>{{ pistaTexto }}</p>
        <p class="pista-penalizacion">
            <i class="pi pi-exclamation-triangle"></i>
            Se han restado 10 puntos
        </p>
    </div>

    <ng-template pTemplate="footer">
        <p-button
            label="Entendido"
            (onClick)="mostrarDialogPista = false">
        </p-button>
    </ng-template>
</p-dialog>

<!-- Dialog: Abandonar Misi√≥n -->
<p-dialog
    [(visible)]="mostrarDialogAbandonar"
    [modal]="true"
    [style]="{width: '450px'}"
    header="‚ö†Ô∏è Abandonar Misi√≥n">

    <div class="abandonar-contenido">
        <p>¬øEst√°s seguro de que quieres abandonar esta misi√≥n?</p>
        <p class="advertencia">
            Tu progreso actual se perder√° y deber√°s comenzar desde el inicio.
        </p>
    </div>

    <ng-template pTemplate="footer">
        <p-button
            label="Cancelar"
            severity="secondary"
            [outlined]="true"
            (onClick)="mostrarDialogAbandonar = false">
        </p-button>
        <p-button
            label="Abandonar"
            severity="danger"
            icon="pi pi-times"
            (onClick)="abandonarMision()">
        </p-button>
    </ng-template>
</p-dialog>

<!-- Dialog: Misi√≥n Completada -->
<p-dialog
    [(visible)]="mostrarDialogCompletada"
    [modal]="true"
    [closable]="false"
    [style]="{width: '500px'}">

    <ng-template pTemplate="header">
        <div class="completada-header">
            <i class="pi pi-check-circle"></i>
            <h2>¬°Misi√≥n Completada!</h2>
        </div>
    </ng-template>

    <div class="completada-contenido" *ngIf="mision">
        <h3>{{ mision.titulo }}</h3>

        <div class="resultados-finales">
            <div class="resultado-item">
                <i class="pi pi-clock"></i>
                <div>
                    <span class="label">Tiempo:</span>
                    <span class="valor">{{ formatearTiempo(progreso!.tiempoTranscurrido) }}</span>
                </div>
            </div>

            <div class="resultado-item">
                <i class="pi pi-percentage"></i>
                <div>
                    <span class="label">Precisi√≥n:</span>
                    <span class="valor">
            {{ (progreso!.respuestasCorrectas / progreso!.intentos * 100) | number:'1.0-0' }}%
          </span>
                </div>
            </div>

            <div class="resultado-item destacado">
                <i class="pi pi-star-fill"></i>
                <div>
                    <span class="label">Puntuaci√≥n Final:</span>
                    <span class="valor">{{ progreso!.puntuacion }}</span>
                </div>
            </div>
        </div>

        <p-divider></p-divider>

        <div class="recompensas-obtenidas">
            <h4>üéÅ Recompensas Obtenidas:</h4>

            <div class="recompensa-grande">
                <i class="pi pi-bolt"></i>
                <span>+{{ mision.recompensas.experiencia }} Experiencia</span>
            </div>

            <div class="insignias-obtenidas">
                <div *ngFor="let insignia of mision.recompensas.insignias" class="insignia-obtenida">
                    <span class="insignia-icono-xl">{{ insignia.icono }}</span>
                    <p class="insignia-nombre">{{ insignia.nombre }}</p>
                    <p class="insignia-desc">{{ insignia.nombreKichwa }}</p>
                </div>
            </div>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <p-button
            label="Ver Resultados Detallados"
            icon="pi pi-eye"
            styleClass="w-full"
            (onClick)="finalizarMision()">
        </p-button>
    </ng-template>
</p-dialog>

<!-- Al final de ejecutar-mision.component.html, despu√©s del dialog de "Misi√≥n Completada" -->

<!-- Dialog: Mapa de Exploraci√≥n -->
<p-dialog
    [(visible)]="mostrarDialogMapa"
    [modal]="true"
    [closable]="true"
    [style]="{width: '90vw', height: '90vh'}"
    header="Explorar Ingapirca">

    <div class="mapa-exploracion-container">
        <!-- Aqu√≠ ir√≠a el componente del mapa -->
        <app-mapa-ingapirca
            *ngIf="puntoActualMapa"
            [puntoDestacado]="puntoActualMapa"
            [modoVisita]="true"
            (puntoVisitado)="onPuntoVisitadoEnMapa()">
        </app-mapa-ingapirca>

        <!-- O si no tienes el componente listo, un placeholder -->
        <div class="mapa-placeholder">
            <i class="pi pi-map" style="font-size: 5rem; color: #cbd5e1;"></i>
            <h3>Mapa de Ingapirca</h3>
            <p>Punto a visitar: #{{ puntoActualMapa }}</p>
            <p-button
                label="Marcar como Visitado"
                icon="pi pi-check"
                (onClick)="onPuntoVisitadoEnMapa()">
            </p-button>
        </div>
    </div>
</p-dialog>

<p-toast position="top-center"></p-toast>
